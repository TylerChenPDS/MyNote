# tdh 5.2.4 升级到 6.0.2

## 配置3台主机 transwarp用户互相免密登录

1，三台主机都切换到transwarp用户，执行

```shell
ssh-keygen -t rsa 
```

2， 再tdh-100  中执行

```shell
cat /home/transwarp/.ssh/id_rsa.pub >> /home/transwarp/.ssh/authorized_keys
#将密钥复制到其他两台主机上
ssh transwarp@tdh-101 cat /home/transwarp/.ssh/id_rsa.pub >> /home/transwarp/.ssh/authorized_keys

ssh transwarp@tdh-102 cat /home/transwarp/.ssh/id_rsa.pub >> /home/transwarp/.ssh/authorized_keys
```

现在其他两台主机可以免密登录tdh-100了

3， 进入tdh-101, tdh-102 执行2





## 需要关闭TOS服务

![image-20210107101214822](https://gitee.com/CTLQAQ/picgo/raw/master/image-20210107101214822.png)





可以进入图形界面，先关许可证，再关zk

### 问题1

```shell
2021-01-07 01:03:29.659402 I | etcdserver/membership: set the cluster version to 2.3 from store
waiting for etcd to close and release its lock on "/var/etcd/data/member/snap/db"
finished transforming keys
tdh-100:4001 is unhealthy: failed to connect: dial tcp 172.22.8.100:4001: connect: connection refused
Error: unhealthy cluster
tdh-101:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
tdh-102:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
Waiting etcdv3.1.18 to be ready ...
tdh-100:4001 is unhealthy: failed to connect: dial tcp 172.22.8.100:4001: connect: connection refused
Error: unhealthy cluster
tdh-101:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
tdh-102:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
Waiting etcdv3.1.18 to be ready ...
tdh-100:4001 is unhealthy: failed to connect: dial tcp 172.22.8.100:4001: connect: connection refused
Error: unhealthy cluster
tdh-101:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
tdh-102:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
Waiting etcdv3.1.18 to be ready ...
tdh-100:4001 is unhealthy: failed to connect: dial tcp 172.22.8.100:4001: connect: connection refused
Error: unhealthy cluster
tdh-101:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
tdh-102:4001 is unhealthy: failed to commit proposal: context deadline exceeded
Error: unhealthy cluster
Waiting etcdv3.1.18 to be ready ...
```

### 问题2

![image-20210107153543313](https://gitee.com/CTLQAQ/picgo/raw/master/image-20210107153543313.png)

手工重启tos



### 问题3

![image-20210107160933749](https://gitee.com/CTLQAQ/picgo/raw/master/image-20210107160933749.png)

# tdh 5.2.4 升级到 7.0

## 首先要确保TOS正常

# screen 使用

```shell
#创建一个ttt的窗口
screen -S  ttt
#暂时退出窗口
ctrl a  ctrl d
#查看窗口
screen -ls
#重新进入窗口
screen -r tt
#进入窗口后永久退出这个窗口，只需要输入exit就可以了
```

